@model WeatherForecast.Models.WeatherForecastModel
@{
    ViewBag.Title = "Home Page";
}

<h1 class="row text-center">Weather Forecast App</h1>

@using (Html.BeginForm("WeatherForecastByCityName", "Home", FormMethod.Get))
{
    <div class="row">
        <div class="col-md-6 col-md-offset-2"><input type="text" class="form-control" name="cityName" /></div>
        <div class="col-md-2"><input type="submit" class="btn btn-primary btn-block" value="Find" /></div>
    </div>
}

@if (Model != null)
{
    <div class="row">
        <h3 class="col-md-6 col-md-offset-3 text-center">
            @Html.Label($"Hourly weather and forecasts in {Model.City.Name}, {Model.City.Country}")
        </h3>
    </div>
    <div class="row col-md-6 col-md-offset-3 text-center">
        @{
            var nowDayOfWeek = DateTime.Today.DayOfWeek;
            for (var i = 0; i < Model.List.Count;)
            {
                //var rowDayOfWeek = Model.List[i].DtTxt.DayOfWeek;
                var rowDate = Model.List[i].DtTxt;
                <div class="panel panel-default">
                    <div class="panel-heading panel-title">
                        @{
                            var today = rowDate.DayOfWeek == nowDayOfWeek ? " Today": string.Empty;
                        }
                        @Html.Label($"{rowDate:dddd, dd MMMM yyyy}{today}")
                    </div>
                    <div class="panel-body">
                        @while ((i < Model.List.Count) && (rowDate.DayOfWeek == Model.List[i].DtTxt.DayOfWeek))
                        {
                            <div class="row">
                                @{
                                    var temp = $"{Model.List[i].Main.Temp} °C";
                                    var time = $"{Model.List[i].DtTxt:HH:mm}";
                                    var img = $"http://openweathermap.org/img/w/{Model.List[i].Weather.First().Icon}.png";
                                    var rainType = $"{Model.List[i].Weather.First().Description}";
                                    var extra = $"{Model.List[i].Wind.Speed}, m/s clouds: {Model.List[i].Clouds.All}%, {Model.List[i].Main.Pressure} hpa";
                                }
                                <div class="col-md-3">
                                    @time
                                    <img src="@img" alt="@rainType" />
                                </div>
                                <div class="col-md-7 col-md-offset-2 text-left">
                                    <div class="label label-default">@temp</div>
                                    <span class="rainType">@rainType</span>
                                    <div>@extra</div>
                                </div>
                            </div>
                            i++;
                            if ((i < Model.List.Count) && (Model.List[i].DtTxt.DayOfWeek == rowDate.DayOfWeek))
                            {
                                <hr />
                            }
                        }
                    </div>
                </div>

            }
        }
    </div>
}